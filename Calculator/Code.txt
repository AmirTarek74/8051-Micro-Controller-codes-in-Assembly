RS  		EQU P0.0
E  			EQU P0.1
DIGIT 		EQU	P0.2
DIVISION	EQU P0.3
MULT		EQU P0.4
ADDATION	EQU P0.5
SUBSTRACT	EQU P0.6	
EQUAL		EQU P0.7
LCD 		EQU P2
ORG 00H
	;LCD CONFIGURATIONS
		
	MOV A,#38H ; MATRIX
	ACALL COMMAND
	
	MOV A,#1H 	; CLEAR LCD
	ACALL COMMAND
	
	MOV A,#0EH ; DISPALY ON CURSOR BLINK
	ACALL COMMAND
	
	MOV A,#80H ;FORCE CURSOR TO BEGIN AT FIRST LINE
	ACALL COMMAND
		    
FIRSTNUMBER:	MOV R6,#0 	;First Number
				HOLD:ACALL KEYPAD
				JNB DIGIT,HOLD 
				CLR RS 	;COMMAND
				MOV LCD,#01H
				SETB E
				CLR E
				ACALL DISPLAY
				MOV B,R7
				MOV R6,B
	SECONDDIGIT:ACALL KEYPAD
				JB ADDATION,SUM
				JB DIVISION,DIVFUN
				JB MULT,MULTFUN
				JB SUBSTRACT,SUB
				JNB DIGIT,SECONDDIGIT
				MOV A,R6
				MOV B,#10
				MUL AB
				ADD A,R7
				MOV R6,A
	THIRDDIGIT:	ACALL KEYPAD
				JB ADDATION,SUM
				JB DIVISION,DIVFUN
				JB MULT,MULTFUN
				JB SUBSTRACT,SUB
				JNB DIGIT,THIRDDIGIT
				MOV A,R6
				MOV B,#10
				MUL AB
				ADD A,R7
				MOV R6,A  ; FIRST NUMBER IS IN R6
	OPERATION:	ACALL KEYPAD
				JB ADDATION,SUM
				JB DIVISION,DIVFUN
				JB MULT,MULTFUN
				JB SUBSTRACT,SUB
				SJMP OPERATION
	
SUM:	 
		 MOV 10H,#1 ;check for syntax error
		 ACALL SECONDNUMBER 
		 MOV A,R5
		 ADD A,R6
		 LJMP SHOW

DIVFUN:
		 MOV 10H,#1 ;check for syntax error
		 ACALL SECONDNUMBER 
		 MOV A,R6
		 MOV B,R5
		 CJNE R5,#0,DIVIDING  
		 MOV DPTR,#300H
		 MOV A,#0C6H
		 ACALL COMMAND
		 LJMP MESSAGE ;error message when dividing by zero
		 DIVIDING: DIV AB
		 MOV R7,B ;REMINDER
		 CJNE R7,#0, DONEEEE ;check for reminder
		 LJMP SHOW
DONEEEE: LJMP SHOWDIV

MULTFUN:
		 MOV 10H,#1 ;check for syntax error
		 ACALL SECONDNUMBER 
		 MOV A,R5
		 MOV B,R6
		 MUL AB
		 SJMP SHOW

SUB:
		 MOV 10H,#1 ;check for syntax error
		 ACALL SECONDNUMBER 
		 MOV A,R6
		 CLR C
		 SUBB A,R5
		 JNC SHOW   ; R6>=R5
		 CPL A
		 INC A
		 LJMP SHOWNEG
		 
SECONDNUMBER:
				 MOV R5,#0  ; SECOND NUMBER
		HOLD1:   ACALL KEYPAD
				 JB ADDATION,CONT2
				 JB DIVISION,CONT2
				 JB MULT,CONT2
				 JB SUBSTRACT,CONT2
				 JB DIGIT,CONT4 
				 SJMP HOLD1
		CONT2: 	 MOV 10H,#2  ; SYNATX ERORR
		CONT3:   ACALL KEYPAD
				 JNB DIGIT,CONT3 
		CONT4:	 MOV B,R7
				 MOV R5,B
	SECONDDIGIT1:ACALL KEYPAD
				JB EQUAL,CONT
				JNB DIGIT,SECONDDIGIT1
				MOV A,R5
				MOV B,#10
				MUL AB
				ADD A,R7
				MOV R5,A
	THIRDDIGIT1: ACALL KEYPAD
				JB EQUAL,CONT
				JNB DIGIT,THIRDDIGIT1
				MOV A,R5
				MOV B,#10
				MUL AB
				ADD A,R7
				MOV R5,A
	DONEE:		ACALL KEYPAD
				JNB EQUAL,DONEE
	CONT: 		MOV A,10H
				CJNE A,#2,DONEEE
				MOV DPTR,#320H	
				MOV A,#0C3H
				ACALL COMMAND
				LJMP MESSAGE ;error message when the user enters two operators
	DONEEE:		RET


SHOW:
REPEAT: MOV B,#10
		DIV AB
		MOV R3,B
		JZ ONEDIGIT
		MOV B,#10
		DIV AB
		MOV R2,B
		JZ TWODIGIT
		MOV B,#10
		DIV AB	
		MOV R4,B
		MOV A,#0CDH 
		ACALL COMMAND
		MOV A,R4
		ADD A,#30H
		ACALL DISPLAY
TWODIGIT:MOV A,#0CEH 
		ACALL COMMAND
		MOV A,R2
		ADD A,#30H
		ACALL DISPLAY
ONEDIGIT:MOV A,#0CFH 
		ACALL COMMAND
		MOV A,R3
		ADD A,#30H
		ACALL DISPLAY
HOLLD:	LJMP FIRSTNUMBER

SHOWDIV: MOV B,#10
		DIV AB
		MOV R1,B
		MOV R3,B
		JZ ONEDIGIT2
		MOV B,#10
		DIV AB
		MOV R2,B
		JZ TWODIGIT2
		MOV B,#10
		DIV AB	
		MOV R4,B
		MOV A,#0CBH 
		ACALL COMMAND
		MOV A,R4
		ADD A,#30H
		ACALL DISPLAY
TWODIGIT2: MOV A,#0CCH 
		ACALL COMMAND
		MOV A,R2
		ADD A,#30H
		ACALL DISPLAY
ONEDIGIT2:MOV A,#0CDH 
		ACALL COMMAND
		MOV A,R3
		ADD A,#30H
		ACALL DISPLAY
		MOV A,#2EH ;DECIMAL POINT
		ACALL DISPLAY
		MOV A,R7
		MOV B,#10
		MUL AB
		MOV B,R5
		DIV AB
		MOV R7,A
		MOV A, R7
		ADD A,#30H
		ACALL DISPLAY
HOLLD2:	LJMP FIRSTNUMBER

SHOWNEG:MOV B,#10
		DIV AB
		MOV R3,B
		JZ ONEDIGIT1
		MOV B,#10
		DIV AB
		MOV R2,B
		JZ TWODIGIT1
		MOV B,#10
		DIV AB	
		MOV R4,B
		MOV A,#0CCH 
		ACALL COMMAND
		MOV A,#2DH ;MINUS SIGN
		ACALL DISPLAY
		MOV A,#0CDH 
		ACALL COMMAND
		MOV A,R4
		ADD A,#30H
		ACALL DISPLAY
		SJMP SEC
TWODIGIT1:MOV A,#0CDH 
		ACALL COMMAND
		MOV A,#2DH ;MINUS SIGN
		ACALL DISPLAY
		SEC:MOV A,#0CEH 
		ACALL COMMAND
		MOV A,R2
		ADD A,#30H
		ACALL DISPLAY
		SJMP THIRD
ONEDIGIT1:MOV A,#0CEH 
		ACALL COMMAND
		MOV A,#2DH ;MINUS SIGN
		ACALL DISPLAY
		THIRD:MOV A,#0CFH 
		ACALL COMMAND
		MOV A,R3
		ADD A,#30H
		ACALL DISPLAY
HOLLD1:	LJMP FIRSTNUMBER



KEYPAD:
	 CLR DIGIT
	 CLR DIVISION
	 CLR MULT
	 CLR ADDATION
	 CLR SUBSTRACT
	 CLR EQUAL
	 
	 MOV P1,#0FFh  ; PORT 1 INPUT
	 ACALL DELAY
     CLR P1.2 
     JB P1.4,EIGHT  
     MOV A,#37H 
	 MOV R7,#7
	 SETB DIGIT
     ACALL DISPLAY  
EIGHT:
	  JB P1.5,NINE 
      MOV A,#38H
	  MOV R7,#8
	  SETB DIGIT
      ACALL DISPLAY
NINE:	
	  JB P1.6,DIVISIONSIGN
      MOV A,#39H
	  MOV R7,#9
	  SETB DIGIT
      ACALL DISPLAY
DIVISIONSIGN:
	  JB P1.7,FOUR
      MOV A,#2FH
	  SETB DIVISION
      ACALL DISPLAY
FOUR: 
	  SETB P1.2
	  ACALL DELAY
	  ACALL DELAY
      CLR P1.1
      JB P1.4,FIVE
      MOV A,#34H
	  MOV R7,#4
	  SETB DIGIT
      ACALL DISPLAY
FIVE:
	  JB P1.5,SIX
      MOV A,#35H
	  MOV R7,#5
	  SETB DIGIT
      ACALL DISPLAY
SIX:
	  JB P1.6,MULTPLICATION
      MOV A,#36H
	  MOV R7,#6
	  SETB DIGIT
      ACALL DISPLAY
MULTPLICATION:
	  JB P1.7,ONE
      MOV A,#2AH
	  SETB MULT
      ACALL DISPLAY
ONE:  
	  SETB P1.1
	  ACALL DELAY
	  ACALL DELAY
      CLR P1.0
      JB P1.4,TWO
      MOV A,#31H
	  MOV R7,#1
	  SETB DIGIT
      ACALL DISPLAY
TWO:
	  JB P1.5,THREE
      MOV A,#32H
	  MOV R7,#2
	  SETB DIGIT
      ACALL DISPLAY
THREE:
	   JB P1.6,MUNIS
       MOV A,#33H
	   MOV R7,#3
	   SETB DIGIT
       ACALL DISPLAY
MUNIS:
	   JB P1.7,ON
       MOV A,#2DH
	   SETB SUBSTRACT
       ACALL DISPLAY
ON:	   
	   SETB RS 
	   SETB P1.0
	   ACALL DELAY
	   ACALL DELAY
       CLR P1.3
       JB P1.4,ZERO
	   CLR RS 	;COMMAND
       MOV LCD,#01H
	   SETB E
	   CLR E 
	   MOV R5,#0
	   MOV R6,#0
	   LJMP FIRSTNUMBER
ZERO:
	   JB P1.5,EQUALSIGN
       MOV A,#30H
	   MOV R7,#0
	   SETB DIGIT
       ACALL DISPLAY
EQUALSIGN:
	   JB P1.6,PLUS
       MOV A,#3DH
	   SETB EQUAL

PLUS:
	   JB P1.7,DONE
       MOV A,#2BH
	   SETB ADDATION
       ACALL DISPLAY
       DONE: RET


COMMAND:
		ACALL DELAY;
		CLR RS ; RS VALUE 0 FOR COMMAND
		MOV LCD,A
		SETB E
		CLR E
		RET
		
DISPLAY:
		ACALL DELAY
		SETB RS ; RS VALUE 1 FOR VALUE
		MOV LCD,A
		SETB E 	; ENABLE 
		CLR E 
		HERE1:JNB P1.4,HERE1	;FOR HOLDING  THE BUTTON
		HERE2:JNB P1.5,HERE2	;FOR HOLDING  THE BUTTON
		HERE3:JNB P1.6,HERE3	;FOR HOLDING  THE BUTTON
		HERE4:JNB P1.7,HERE4	;FOR HOLDING  THE BUTTON
		CLR RS
		ACALL DELAY
		RET
	
DELAY:
		MOV R0,#150
		H1:MOV R1,#50
		H2:DJNZ R1,H2
		DJNZ R0,H1
		RET
		
MESSAGE:
AGAIN22: CLR A
		 MOVC A,@A+DPTR
		 JZ DONE22
		 INC DPTR
		 ACALL DISPLAY
		 ACALL DELAY
		 ACALL DELAY
		 SJMP AGAIN22
		 DONE22: LJMP FIRSTNUMBER

ORG 300H
	WELCOME: DB "MATH ERROR",0	

ORG 320H
	MESS: DB "SYNTAX ERROR!",0
END
